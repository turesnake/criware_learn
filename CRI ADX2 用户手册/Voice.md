# ======================================================================= #
#                    Voice
# ======================================================================= #
"Voice"是播放音频的最基本对象。



# ======================================================================= #
#                  关于Voice
# ======================================================================= #

# 什么是Voice？
Voice是音频播放最基本的对象。
执行数据读取、音频解码、发声处理等。
指示开始播放后，从Voice池分配Voice，执行实际的播放。
需要使用一个Voice播放一个波形数据。 应用程序可同时播放的波形数据数量受Voice数量限制。


# ------------------------------
# 虚拟Voice（Virtual Voice）
# 指定Voice数量
可以在创建Voice池时指定Voice数量，并能够在应用程序端自由控制最大同时发声数。
但由于内存大小和CPU负荷也会与使用的Voice数量成比例增加，因此必须将Voice数量压缩到应用程序允许的范围。
此外，在Voice使用硬件Voice的平台中，创建的Voice数量不能超出硬件限制。


# 什么是虚拟Voice？
除Voice外，CRI Atom运行库还使用名为"虚拟Voice"的虚拟Voice对象。
虚拟Voice执行参数管理、播放时间管理，是管理用于音频输出的Voice的对象。

通常，虚拟Voice与Voice成对运行，用户不需要知道虚拟Voice存在。
但其实也可以通过更改Voice分配方式，使用虚拟Voice作为没有Voice的虚拟声源。


# 虚拟Voice的预设动作
预设状态下，CRI Atom库将虚拟Voice和Voice设为一组执行播放。
例如，为Player设置音频数据，执行播放函数后，Player只分配需要的数量的虚拟Voice和Voice。
此时，如果可以分配虚拟Voice和Voice，则播放音频，而只要其中一个不能分配，则设置的数据不会发声。


# 将虚拟Voice用作虚拟声源
將分配Voice指定为"将虚拟Voice用作虚拟声源"，则即使Player在播放开始时无法分配Voice,也可以只使用虚拟Voice开始播放音频。
由于无法分配Voice，因此不会执行发声处理，而会通过虚拟Voice执行参数更改记录和播放位置管理。
此外，虚拟Voice在播放期间监控Voice有无空闲，并在有空闲Voice时重新获取Voice。
因此，即使在播放开始时无法分配Voice或在播放期间Voice因优先级控制被抢占，只要之后有空闲Voice，就能够恢复播放。



# ======================================================================= #
#                    动态Voice分配
# ======================================================================= #

# 从Voice池分配Voice
"动态Voice分配"是根据为声音设置的优先级从而动态分配Voice的功能。
Player句柄在播放声音时，是从"Voice池"获取Voice。
此时，如果Voice池中不存在Voice，则停止当前正在播放的优先级最低的Voice的播放，使用该Voice进行播放。


# Voice限数组
例如，如果"只想同时播放三声枪声"，请使用"Voice限数组"。

# 发声优先级
创建名为"枪声组"的Voice限数组，将最大发声数设置为3。如果为各种枪声设置名为"枪声组"的Voice限数组，则属于该组的声音最多只能同时播放3声。
此外，可以为Voice限数组设置达到限制时的操作，如"先发优先"和"后发优先"等。
例如，枪声适用后发优先操作，后来的发声请求将删除最旧的发声。
与此相对，台词等则比较适用"先发优先"操作，以防止正在播放的台词被下一个台词的播放要求而停止。

［备注1］通过Cue和Voice对发声数量进行控制
发声数控制功能可分别应用于Cue和Voice。
先执行Cue的发声数控制，再执行Voice发声数控制。

［备注2］Cue的发声数控制方法
"Cue限数"
指定该Cue可多次播放多少声音的数量。
"类别Cue优先级"
如果想要控制Cue之间的发声优先级和发声数，请使用"类别"功能。


# ======================================================================= #
#                    Atom声音渲染器
# ======================================================================= #

压缩数据的解码和效果等信号处理因平台而异。
在PC、固定设备型家用游戏机等高计算能力平台上，通过 "Atom声音渲染器" 用软件执行所有的信号处理。

具有声音硬件的平台用硬件执行效果和混音等处理。

如果是平台原有压缩格式时,将使用硬件解码; 如果是独家压缩编解码器时,将使用软件解码。




# ======================================================================= #
#                    序列(Sequence)
# ======================================================================= #
# 什么是序列？
"序列"是在时间轴上配置声音和事件（循环等），进行播放和控制的功能。
Cue可以有多个音轨，每个音轨都有一个时间轴。
只需将波形数据和Cue粘贴到音轨中，即可轻松创建序列。
由于输出文件中只包含发声的时间信息和播放参数，可以在节约容量的同时创建各种声音。
此外，可以一边引用视频文件一边创建序列。


# 创建序列数据
在CRI Atom Craft设置了以下参数时，ADX2将数据创建为序列。
为Cue设置"音轨自动执行"
为Cue设置"事件"（循环、结束等）
在音轨中配置两个以上的声音
为音轨中的声音设置延迟值


# ======================================================================= #
#                    Panning  (声像)
# ======================================================================= #
CRI Atom文件库支持立体声系统的"2D Pan" 以及5.1 (7.1)声道的"3D Pan"。


# tpr 额外说明"
https://zhuanlan.zhihu.com/p/53544624

一. 什么是声像？
声像的英文单词为Panning（通常被简称为Pan）。在DAW（宿主）中，常常是通过一个游标来控制声像位置的（指的是声像电位器），当将游标往左平移时，声音信号就会偏向左声道，反之会偏向右声道。而当游标在C位时（正中间），声音信号则会位于两耳的中央，这就是声像。请注意，以上描述是在立体声监听的前提下写的，在单声道监听中不存在声像概念。



# 2D Pan
Unity本身并不提供2D Pan功能。
您可以如下使用3D Pan功能来实现2D Pan。
- 将 CriAtomSource.pan3dDistance 设为 1.0f
- 将 CriAtomSource.pan3dAngle 的 Panning范围设为 -30 至 30 （在 -30时，音频仅从左扬声器输出；在30时，音频仅从右扬声器输出。）

# 注意:
以上2D Pan仅用于单声道音频。
注意无法在立体声音频上正常使用Panning。

# 3D Pan
以下三种方法可用于配置3D Pan。

如何为每个扬声器设置发送Level（音量)
如何设置 3D Panning值 (角度和内部距离)
如何设置收听者信息和声源信息(位置)

内部距离是可以使用在扬声器内部移动声像时。
1.0为最外周，用一个或两个扬声器播放。
如果为0.0，则从所有扬声器听到相同的音量，声像与收听者处于相同的位置。
如果是0至1.0之间的值，则从3个以上扬声器输出，可实现自然的声像移动。

# ======================================================================= #
#                    3D定位
# ======================================================================= #

声像的位置控制方法支持"3D定位"。

- 根据收听者和声源信息设置对各扬声器的发送Level。
- 可以根据收听者和声源速度获得多谱勒效应。
- 可以将Player句柄作为声源处理。
设置收听者的位置和速度等信息时，将自动计算发送Level和音高。
- 也在多个视点的情况下，还支持 Multiple listeners 。

# 收听者信息
位置 (x, y, z) 收听者的位置。
速度 (x, y, z) 收听者的移动速度。
向前的姿势向量 (x, y, z) 收听者面对的方向。
向上的姿势向量 (x, y, z) 收听者头顶的方向。


# 声源信息
位置 (x, y, z) 声源的位置。
速度 (x, y, z) 声源的速度。
声锥的方向 (x, y, z) 产生声源的声音方向。
声锥信息 (内部角度、外部角度、外部音量) 显示声音扩张和环绕。
最大距离、最小距离
    指定受距离衰减影响的距离范围。
    在最小距离内侧和最大距离外侧，不受距离衰减的影响。
    此外，在最小距离内侧，可以通过内部Panning获得逐渐穿过对面扬声器但不更改音量的效果。
多谱勒增益
    为物理计算的多谱勒效应指定夸张演出所需的倍率。
自定义距离衰减AISAC
    通过应用距离衰减AISAC，可以设置该声音特定的距离衰减曲线。
传播系数（※当前版本不支持）
    将单声道声音扩张为立体声声音的值。



# ======================================================================= #
#                  空间声音连接功能 "3D收发器"
# ======================================================================= #

在3D定位功能中，新增了空间声音连接功能"3D收发器"。
此功能是将声音在3D定位的虚拟空间中进行子混音并从收发器合并输出的功能。

通过此功能，如上图所示，将存在于被墙壁包圍的空间中的3D声源进行分组， 然后将声音进行子混音并传输至墙壁外的空间的3D收听者处。

在没有使用3D收发器的3D定位中，即使在游戏中的房间内有声源， 声像的方向也会忽略墙壁。而通过使用该功能， 可以从开口部合并输出于封闭空间中的声音。 相反，当收听者进入封闭空间时，可以在入口处收集和输出外界声音。

此功能可以通过在原有的3D声源和3D收听者中添加3D区域（该区域执行按空间分组的元素） 并设置3D收发器后使用。 3D声源和3D收听者将根据添加的3D区域自动分组。 分组后的声源将对具有另一个3D区域的3D收听者从3D收发器输出声音。

在切换收听者的3D区域时，为防止音像有急剧变化， 3D收发器中包含交叉渐变功能。 可以在3D收发器中指定交叉渐变距离， 根据此范围内从收听者至收发器的输入位置之距离， 将交叉渐变从收发器输出的可听到的声音和从3D声源可听到的声音。
在直接声音区域中，3D声源的声音平衡将变为100％。 因此，可以通过在直接声音区域中切换3D收听者的3D区域 来无缝更改声像。

此外，当3D声源接近3D收发器时， 将根据交叉渐变区域的设置和声源与收发器的输入位置之间的距离同时进行交叉渐变。 即使在这种情况下，当声源直接通过直接声音区域时，也可以通过切换3D声源的3D区域 来无缝更改声像。

此外，如上图所示，3D收发器可以分别设置音频的输入位置和输出位置。 使用此功能可以实现将远处的声音合并输出的麦克风和扬声器效果，以及 在多个角色之间的无线通信等。

# 处理负荷
这里的子混音实际上并非指混合和处理信号， 因为通过扩展参数运算内容，实际上执行了与正常3D定位的音像定位相同的处理， 处理负荷也与3D定位相若。

# ======================================================================= #
#                             AISAC
# ======================================================================= #

# 什么是AISAC？
应用程序可以通过使用 "AISAC" 来实现发动机声音等交互声音。
声音设计师会根据程序员传递过来的 "AISAC控制器值" ，在创建工具上设计如何将声音变化。

例如，可以设计音高如何根据发动机转速而变化，如何交叉渐变多个活塞的爆炸声等。
然后，程序员对Player句柄设置根据应用程序的情况所确定的AISAC控制器值，将根据情况播放声音。


# 通过多个AISAC控制
一个Cue可以有多个AISAC控制器。
可以设置多个AISAC控制器值，例如AISAC控制器1设置"发动机的转速"， AISAC控制器2设置"发动机负载"， AISAC控制器3设置"距收听者的距离"。


# 区分使用多个AISAC模式
也可以对一个AISAC控制器区分使用多个AISAC模式。
例如，为"距离衰减AISAC控制器"提供"脚步声的AISAC模式""爆炸声的AISAC模式""台词的AISAC模式"，可以为每个声音选择模式。
程序员不需要知道应用了哪种模式，只需要为"距离衰减AISAC控制器"设置值，即可实现根据声音类型而变化的高级距离衰减。


# 通过AISAC调制进行自动控制
还可以通过"AISAC调制功能"自动使用AISAC控制器值。
例如，可以设计环境声音如何按照时间变化，因应用程序中的兴奋程度增加时发出欢呼声等。
AISAC调制可以在播放开始时或通过"REACT "的任意时间驱动。


# ======================================================================= #
#                       总线和频道条
# ======================================================================= #

# Atom声音渲染器（Atom Sound Renderer）
由于本系统支持多平台,可以软件执行效果等信号处理或以在有声音硬件的平台上处理。
在PC、固定设备型家用游戏机等高计算能力平台上，通过本系统的软件整合器 "Atom声音渲染器" 执行处理。

# 总线和频道条
Atom声音渲染器支持总线和频道条的概念，可实现灵活的信号处理。
总线始终连接到一个频道条。
频道条可对8个总线分别设置发送Level并输出。


# Voice的内部结构和连接
Voice具有解码器、速率转换器、滤波器、频道条，可以向多个总线发送声音。
发出的音频数据最终在主总线中混合，通过平台的声音系统输出为最终的声音信号。

速率转换器
将波形数据的采样率转换为频道条和总线的采样率。
频道条
包括音量、效果和Panner，处理输入音频,可以以不同发送Level最多发送到8个总线。
效果
可以从多个效果程序中选择并使用效果。

# ======================================================================= #
#                       类别  category
# ======================================================================= #

"类别"是合并控制多个声音的机制。
声音设计师可以使用创作工具先为每个Cue设置类别。
可以设置最多4个类别 。

即使在通过多个Player句柄播放多个声音的情况下，如果指定类别并更改播放参数，也只会更改属于该类别的声音。
此外，也可以操作不属于类别的声音。
例如，可以通过减小"台词"类别以外的声音来实现突出台词的效果（闪避/Ducking）。

可以为类别设置以下参数。
音量
Cue限制数


# ======================================================================= #
#                       REACT
# ======================================================================= #
"REACT"是控制类别之间依赖关系的功能。
通过在工具上设置REACT功能，运行时无需控制即可调整类别与类别之间的音量平衡。
例如，可以无需程序员参与，即可实现播放"台词类别"的声音时将"音乐类别"的声音变小（闪避）等控制。


# ======================================================================= #
#                     块（Block）播放
# ======================================================================= #

# 什么是块播放？
"块播放"功能可以将序列分成Ａ、Ｂ、Ｃ等几个块连续播放。
可以为乐句（块播放）设置各种转换条件，简单地执行复杂播放。


# 块的动作
可以为每个块設置各式各样的块转换。

- 块名
- 块的長度
- 块转换目标
        块播放到末端时的转换方法。（无、下一个块）
- 块循环次数
        在循环完相应次数后转换到另一个块。
- 块分割数
        划分发生块转换的时间间隔。
- 块转换类型
        发生块转换的类型。（在块的末端转换、在分割的位置转换）
- 音轨的块转换时的发声类型
        指定音轨中的波形区域的发声方法。（始终发声、转换时发声、转换后第一次发声）



# ======================================================================= #
#                   音频压缩编解码器
# ======================================================================= #

# 可支持的音频压缩编解码器
本系统支持以下音频压缩编解码器。

编解码器	说明
ADX压缩	    压缩比约为1/4的高音质、低负荷的编解码器
HCA压缩	    压缩比最大为1/16的高音质、高压缩编解码器
HCA-MX压缩	用于HCA-MX播放的特殊编码的HCA数据

-- 以HCA作为推荐音频压缩编解码器。


# 各编解码器的特点

# 关于ADX
ADX是超低负荷的音频压缩编解码器。
虽然压缩比不如HCA等，但解码处理非常轻，可以在低负荷下播放大量声音。

# 关于HCA
HCA是为低负荷、高音质、高压缩而开发的编解码器。
（实现了与mp3或AAC等通用音频编解码器相同程度的压缩比。）
由于HCA的算法简单，比通用音频编解码器负荷低／节省内存。
此外，由于设计上是可以避免因发生突然变化而令负荷变动，因此不会在特定时间干扰应用程序的处理。

用HCA编码时，可以分五级指定音质（压缩比）。
关于编码设置与压缩比的关系，请参照"CRI Atom工具用户手册"。


# 关于HCA-MX
HCA-MX是把HCA数据混音后进行解码的播放方式的名称。
如果使用普通的音频压缩编解码器，播放10个声音时CPU负荷将变成十倍，但采用HCA-MX方式播放可以控制在两倍左右。
音频数据的格式与HCA编解码器的格式相同，可以更改为用于播放HCA-MX的采样率和更改循环区间来执行编码。
如果编码的音频数据不符合HCA-MX播放条件，则编码时可能会更改采样率和播放音高。
播放HCA-MX时，音频数据在混音后解码。
因此，HCA-MX播放时无法以音频单位执行滤波器处理或更改音高，且无法使用无缝连接播放等功能。


可使用的功能
各编解码器可以使用的功能如下。




功能	            ADX	        HCA	        HCA-MX	    备注
循环播放	        可用	    可用	    部分可用	    如果想用HCA-MX执行循环播放，
                                                            则循环区间的样本数必须是128的倍数。
搜索播放	        部分可用	可用	    部分可用	    在ADX搜索播放的播放开始位置和循环位置有噪声。
                                                            在HCA-MX搜索播放中，声音可能会在播放开始位置出现失真。
无缝连接播放	    可用	    可用	    不可用	
滤波器回调	        可用	    可用	    不可用	
更改音量	        可用	    可用	    可用	
更改Pan	            可用	    可用	    可用	
更改音高	        可用	    可用	    不可用	
包络设置	        部分可用	部分可用	不可用	    是否设置包络要取决于机型。
双二阶滤波器	    可用	    可用	    不可用	
带通滤波器	        可用	    可用	    部分可用	HCA-MX的带通滤波器仅以采样率的1/256为单位更改声音。
设置总线发送Level	可用	    可用	    不可用	


# ======================================================================= #
#                   游戏内预览(In-Game Preview)
# ======================================================================= #
"游戏内预览"是指联动真机和CRI Atom Craft后，通过CRI Atom Craft更改游戏播放参数、波形数据、AISAC、3D距离衰减、Voice优先级的功能。

... 两个网页, 略 ...



# ======================================================================= #
#                   动作功能
# ======================================================================= #

# 动作功能的概述
动作提供了除回放Cue文件之外编辑Cue文件的方法。
它可以让小型事件附着于Cue文件，使几乎所有音频的变化都能在数据本身做改动，且不需要额外的编程。

[使用方法范例]
- Cue 1 播放导弹发射和飞行的声音。Cue 2 停止飞行声音，并且播放导弹受到撞击的声音。
- Cue 1 播放电话铃的响声。Cue 2 停止铃声，并且播放某人接起电话的声音。
- 当游戏暂停时，Cue 1 可对正在播放的音乐进行消音。
- Cue 1 播放直升机飞行的声音。Cue 2 更改飞行声音，使其听起来像是直升机飞到了一座山的后面。
- Cue 1 播放直升机旋翼的声音。Cue 2 更改旋翼声音，使其听起来像是直升机正在起飞。
- 你可以配置 选择器 Selector 的标签，使角色在不同的地面上行走时发出不同的脚步声。Cue 1 更改地面的类型（即更改 选择器 的标签。）
- 音乐植入了节拍同步信息。Cue 1 在与节拍同步的同时切换音乐。
...

应用程序本身无需知道Cue文件是否使用了动作。
然而它必须知道是否需要控制动作的范围（即什么会被该动作影响）。
如需了解更多有关添加动作至Cue文件的信息，请参照工具手册。

# 动作范围
用户能够设定数据方面的动作范围。有两种选项可用 - "Whole（整体）"以及"Sound objects（音频文件）"。
当用户选择了"Whole"设定时，程序不用有任何特殊举动。
例如，你可以选择"Whole"选项来控制音乐。
另一方面，用户能够因某一事件的多个事项同时发生（例如导弹声）而指定音频文件，即设置动作的范围。
否则当导弹受到撞击的Cue文件的范围设置为"Whole"时，文件生效时所有正在飞行的导弹都会坠落！
用于Unity的ADX2不支持在程序内创建音频文件。
将动作范围设置为"Sound objects"的Cue文件只会影响到使用同一个播放器句柄播放的Cue文件。
请在程序中创建多个播放器句柄，再根据动作的范围切换它们。

# ======================================================================= #
#                   节拍同步
# ======================================================================= #

Beat synchronization（节拍同步）是一个能在指定时间切换音乐，使过渡显得自然的功能。它同样可以用于播放与音乐同步的音效。
该特征使用了节拍同步数据以及用动作控制的回放。

当我们想要从音乐A切换至音乐B时，音乐B会在程序请求回放的瞬间开始播放。这可能发生在回放一个音符的中途，因此会带来不自然的过渡效果。
（当用户指定了交叉淡入淡出效果，该效果同样会在程序请求回放的瞬间生效。）
在节拍同步的情况下，用户能够在指定时间（例如在某个节拍上）切换音乐，而不是程序请求回放的瞬间。该功能不会让音乐从一个部分唐突地跳转至另一部分，而是自然地过渡音乐。


# 创建数据
创建数据需要以下两个步骤：
配置节拍同步信息
使用动作功能开始回放
如需了解各个步骤的详细信息，请参照工具手册。
如需在工具中预览节拍同步，你必须选中预览菜单中的Single Player Preview（预览单个播放器）选项。

# 配置程序
在程序方面，用户需使用相同的播放器句柄 (CriAtomSource) 来播放音乐A和音乐B。

# ======================================================================= #
#                   选择器   Selector
# ======================================================================= #
Selector（选择器）是一个根据选择器标签来选中Cue文件中某个音轨的功能。
举例，你可以使用选择器，根据玩家行走的地面更改脚步声；或者根据玩家的生命值更改对话。
每个播放器句柄 (CriAtomSource) 都带有一个选择器标签。
你能够使用选择器来简便地切换各个Cue音频。
程序可以使用选择器标签的名称替代AISAC的数值。
如需了解更多为Cue文件设置选择器的信息，请参照工具手册。
注意:
CriAtomSource 不支持程序方面的选择器标签功能。


https://blog.criware.cn/2019/04/29/%E5%88%9D%E7%BA%A709-%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2%EF%BC%88switch%EF%BC%89%E5%92%8C%E9%80%89%E6%8B%A9%E5%99%A8%EF%BC%88selector%EF%BC%89/


